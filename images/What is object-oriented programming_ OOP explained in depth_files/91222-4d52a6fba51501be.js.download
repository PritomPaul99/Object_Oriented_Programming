"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91222],{25456:function(a,b,c){c.d(b,{Ui:function(){return b9},cA:function(){return b6},X0:function(){return q}});var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=c(97486),s=c(42448);let t=a=>a.toLowerCase(),u=/^\s*/g,v=a=>a.replace(u,""),w=/([A-Z])/g,x=(a,b)=>v(a.replace(w,a=>`${b}${t(a)}`)),y=a=>{let b=unescape(encodeURIComponent(a)),c=b.length,d=new Uint8Array(c);for(let e=0;e<c;e++)d[e]=b.codePointAt(e);return d},z="undefined"!=typeof TextEncoder?new TextEncoder:null,A=a=>z.encode(a),B=z?A:y,C="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});C&&1===C.decode(new Uint8Array).length&&(C=null);let D=()=>new Map,E=a=>void 0===a?null:a,F=new class{constructor(){this.map=new Map}setItem(a,b){this.map.set(a,b)}getItem(a){return this.map.get(a)}};try{"undefined"!=typeof localStorage&&(F=localStorage)}catch(G){}let H=F,I=void 0!==s&&s.release&&/node|io\.js/.test(s.release.name);"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let J,K=()=>{if(void 0===J){if(I){J=D();let a=s.argv,b=null;for(let c=0;c<a.length;c++){let d=a[c];"-"===d[0]?(null!==b&&J.set(b,""),b=d):null!==b&&(J.set(b,d),b=null)}null!==b&&J.set(b,"")}else"object"==typeof location?(J=D(),(location.search||"?").slice(1).split("&").forEach(a=>{if(0!==a.length){let[b,c]=a.split("=");J.set(`--${x(b,"-")}`,c),J.set(`-${x(b,"-")}`,c)}})):J=D()}return J},L=a=>K().has(a),M=a=>I?E(s.env[a.toUpperCase()]):E(H.getItem(a));L("--"+(d="production"))||M(d);let N=I&&["true","1","2"].includes(e=s.env.FORCE_COLOR);!L("no-colors")&&(!I||s.stdout.isTTY||N)&&(!I||L("color")||N||null!==M("COLORTERM")||(M("TERM")||"").includes("color"));let O=Math.floor,P=(a,b)=>a<b?a:b,Q=(a,b)=>a>b?a:b,R=Number.MAX_SAFE_INTEGER,S=a=>Error(a),T=S("Unexpected end of array"),U=S("Integer out of Range"),V=(a,b)=>{let c=aa(a.arr.buffer,a.pos+a.arr.byteOffset,b);return a.pos+=b,c},W=a=>V(a,Y(a)),X=a=>a.arr[a.pos++],Y=a=>{let b=0,c=1,d=a.arr.length;for(;a.pos<d;){let e=a.arr[a.pos++];if(b+=(127&e)*c,c*=128,e<128)return b;if(b>R)throw U}throw T},Z=a=>{let b=Y(a);if(0===b)return"";{let c=String.fromCodePoint(X(a));if(--b<100)for(;b--;)c+=String.fromCodePoint(X(a));else for(;b>0;){let d=b<1e4?b:1e4,e=a.arr.subarray(a.pos,a.pos+d);a.pos+=d,c+=String.fromCodePoint.apply(null,e),b-=d}return decodeURIComponent(escape(c))}},$=a=>C.decode(W(a)),_=C?$:Z,aa=(a,b,c)=>new Uint8Array(a,b,c),ab=(a,b)=>{let c=a.cbuf.length;a.cpos===c&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(2*c),a.cpos=0),a.cbuf[a.cpos++]=b},ac=(a,b)=>{for(;b>127;)ab(a,128|127&b),b=O(b/128);ab(a,127&b)},ad=new Uint8Array(3e4),ae=ad.length/3,af=(a,b)=>{if(b.length<ae){let c=z.encodeInto(b,ad).written||0;ac(a,c);for(let d=0;d<c;d++)ab(a,ad[d])}else aj(a,B(b))},ag=(a,b)=>{let c=unescape(encodeURIComponent(b)),d=c.length;ac(a,d);for(let e=0;e<d;e++)ab(a,c.codePointAt(e))},ah=z&&z.encodeInto?af:ag,ai=(a,b)=>{let c=a.cbuf.length,d=a.cpos,e=P(c-d,b.length),f=b.length-e;a.cbuf.set(b.subarray(0,e),d),a.cpos+=e,f>0&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(Q(2*c,f)),a.cbuf.set(b.subarray(e)),a.cpos=f)},aj=(a,b)=>{ac(a,b.byteLength),ai(a,b)};(g=n||(n={}))[g.Token=0]="Token",g[g.PermissionDenied=1]="PermissionDenied",g[g.Authenticated=2]="Authenticated";let ak=(a,b)=>{ac(a,n.Token),ah(a,b)},al=(a,b,c)=>{switch(Y(a)){case n.PermissionDenied:b(_(a));break;case n.Authenticated:c(_(a))}},am={code:1009,reason:"Message Too Big"},an={code:4401,reason:"Unauthorized"},ao={code:4403,reason:"Forbidden"},ap=a=>Array.from(a.entries()).map(([a,b])=>({clientId:a,...b}));async function aq(a){return new Promise((b,c)=>{setTimeout(b,a)})}function ar(a,b){let c=b.delay;if(0===c)return 0;if(b.factor&&(c*=Math.pow(b.factor,a.attemptNum-1),0!==b.maxDelay&&(c=Math.min(c,b.maxDelay))),b.jitter){let d=Math.ceil(b.minDelay),e=Math.floor(c);c=Math.floor(Math.random()*(e-d+1))+d}return Math.round(c)}async function as(a,b){var c;let d=((c=b)||(c={}),{delay:void 0===c.delay?200:c.delay,initialDelay:void 0===c.initialDelay?0:c.initialDelay,minDelay:void 0===c.minDelay?0:c.minDelay,maxDelay:void 0===c.maxDelay?0:c.maxDelay,factor:void 0===c.factor?0:c.factor,maxAttempts:void 0===c.maxAttempts?3:c.maxAttempts,timeout:void 0===c.timeout?0:c.timeout,jitter:!0===c.jitter,handleError:void 0===c.handleError?null:c.handleError,handleTimeout:void 0===c.handleTimeout?null:c.handleTimeout,beforeAttempt:void 0===c.beforeAttempt?null:c.beforeAttempt,calculateDelay:void 0===c.calculateDelay?null:c.calculateDelay});for(let e of["delay","initialDelay","minDelay","maxDelay","maxAttempts","timeout"]){let f=d[e];if(!Number.isInteger(f)||f<0)throw Error(`Value for ${e} must be an integer greater than or equal to 0`)}if(d.factor.constructor!==Number||d.factor<0)throw Error("Value for factor must be a number greater than or equal to 0");if(d.delay<d.minDelay)throw Error(`delay cannot be less than minDelay (delay: ${d.delay}, minDelay: ${d.minDelay}`);let g={attemptNum:0,attemptsRemaining:d.maxAttempts?d.maxAttempts:-1,aborted:!1,abort(){g.aborted=!0}},h=d.calculateDelay||ar;async function i(){if(d.beforeAttempt&&d.beforeAttempt(g,d),g.aborted){let b=Error("Attempt aborted");throw b.code="ATTEMPT_ABORTED",b}let c=async a=>{if(d.handleError&&await d.handleError(a,g,d),g.aborted||0===g.attemptsRemaining)throw a;g.attemptNum++;let b=h(g,d);return b&&await aq(b),i()};return(g.attemptsRemaining>0&&g.attemptsRemaining--,d.timeout)?new Promise((b,e)=>{let f=setTimeout(()=>{if(d.handleTimeout)try{b(d.handleTimeout(g,d))}catch(a){e(a)}else{let c=Error(`Retry timeout (attemptNum: ${g.attemptNum}, timeout: ${d.timeout})`);c.code="ATTEMPT_TIMEOUT",e(c)}},d.timeout);a(g,d).then(a=>{clearTimeout(f),b(a)}).catch(a=>{clearTimeout(f),c(a).then(b).catch(e)})}):a(g,d).catch(c)}let j=d.calculateDelay?d.calculateDelay(g,d):d.initialDelay;return j&&await aq(j),i()}(h=o||(o={}))[h.Connecting=0]="Connecting",h[h.Open=1]="Open",h[h.Closing=2]="Closing",h[h.Closed=3]="Closed";var at=c(42448),au=c(38160).Buffer;let av=()=>new Map,aw=(a,b,c)=>{let d=a.get(b);return void 0===d&&a.set(b,d=c()),d},ax=()=>new Set,ay=String.fromCharCode,az=a=>a.toLowerCase(),aA=/^\s*/g,aB=a=>a.replace(aA,""),aC=/([A-Z])/g,aD=(a,b)=>aB(a.replace(aC,a=>`${b}${az(a)}`)),aE=a=>{let b=unescape(encodeURIComponent(a)),c=b.length,d=new Uint8Array(c);for(let e=0;e<c;e++)d[e]=b.codePointAt(e);return d},aF="undefined"!=typeof TextEncoder?new TextEncoder:null,aG=a=>aF.encode(a),aH=aF?aG:aE,aI="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});aI&&1===aI.decode(new Uint8Array).length&&(aI=null);let aJ=a=>void 0===a?null:a,aK=new class{constructor(){this.map=new Map}setItem(a,b){this.map.set(a,b)}getItem(a){return this.map.get(a)}},aL=!0;try{"undefined"!=typeof localStorage&&(aK=localStorage,aL=!1)}catch(aM){}let aN=aK,aO=a=>aL||removeEventListener("storage",a),aP=Array.from,aQ=Object.keys,aR=(a,b)=>{let c=[];for(let d in a)c.push(b(a[d],d));return c},aS=a=>aQ(a).length,aT=(a,b)=>Object.prototype.hasOwnProperty.call(a,b),aU=(a,b)=>a===b,aV=(a,b)=>{if(null==a||null==b)return aU(a,b);if(a.constructor!==b.constructor)return!1;if(a===b)return!0;switch(a.constructor){case ArrayBuffer:a=new Uint8Array(a),b=new Uint8Array(b);case Uint8Array:if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;break;case Set:if(a.size!==b.size)return!1;for(let d of a)if(!b.has(d))return!1;break;case Map:if(a.size!==b.size)return!1;for(let e of a.keys())if(!b.has(e)||!aV(a.get(e),b.get(e)))return!1;break;case Object:if(aS(a)!==aS(b))return!1;for(let f in a)if(!aT(a,f)||!aV(a[f],b[f]))return!1;break;case Array:if(a.length!==b.length)return!1;for(let g=0;g<a.length;g++)if(!aV(a[g],b[g]))return!1;break;default:return!1}return!0},aW=void 0!==at&&at.release&&/node|io\.js/.test(at.release.name),aX="undefined"!=typeof window&&"undefined"!=typeof document&&!aW;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let aY,aZ=()=>{if(void 0===aY){if(aW){aY=av();let a=at.argv,b=null;for(let c=0;c<a.length;c++){let d=a[c];"-"===d[0]?(null!==b&&aY.set(b,""),b=d):null!==b&&(aY.set(b,d),b=null)}null!==b&&aY.set(b,"")}else"object"==typeof location?(aY=av(),(location.search||"?").slice(1).split("&").forEach(a=>{if(0!==a.length){let[b,c]=a.split("=");aY.set(`--${aD(b,"-")}`,c),aY.set(`-${aD(b,"-")}`,c)}})):aY=av()}return aY},a$=a=>aZ().has(a),a_=a=>aW?aJ(at.env[a.toUpperCase()]):aJ(aN.getItem(a));a$("--"+(i="production"))||a_(i);let a0=aW&&["true","1","2"].includes(j=at.env.FORCE_COLOR);!a$("no-colors")&&(!aW||at.stdout.isTTY||a0)&&(!aW||a$("color")||a0||null!==a_("COLORTERM")||(a_("TERM")||"").includes("color"));let a1=Math.floor,a2=(a,b)=>a<b?a:b,a3=(a,b)=>a>b?a:b,a4=Number.MAX_SAFE_INTEGER;class a5{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}let a6=()=>new a5,a7=a=>{let b=a.cpos;for(let c=0;c<a.bufs.length;c++)b+=a.bufs[c].length;return b},a8=a=>{let b=new Uint8Array(a7(a)),c=0;for(let d=0;d<a.bufs.length;d++){let e=a.bufs[d];b.set(e,c),c+=e.length}return b.set(bv(a.cbuf.buffer,0,a.cpos),c),b},a9=(a,b)=>{let c=a.cbuf.length;a.cpos===c&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(2*c),a.cpos=0),a.cbuf[a.cpos++]=b},ba=(a,b)=>{for(;b>127;)a9(a,128|127&b),b=a1(b/128);a9(a,127&b)},bb=new Uint8Array(3e4),bc=bb.length/3,bd=(a,b)=>{if(b.length<bc){let c=aF.encodeInto(b,bb).written||0;ba(a,c);for(let d=0;d<c;d++)a9(a,bb[d])}else bh(a,aH(b))},be=(a,b)=>{let c=unescape(encodeURIComponent(b)),d=c.length;ba(a,d);for(let e=0;e<d;e++)a9(a,c.codePointAt(e))},bf=aF&&aF.encodeInto?bd:be,bg=(a,b)=>{let c=a.cbuf.length,d=a.cpos,e=a2(c-d,b.length),f=b.length-e;a.cbuf.set(b.subarray(0,e),d),a.cpos+=e,f>0&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(a3(2*c,f)),a.cbuf.set(b.subarray(e)),a.cpos=f)},bh=(a,b)=>{ba(a,b.byteLength),bg(a,b)},bi=a=>Error(a),bj=bi("Unexpected end of array"),bk=bi("Integer out of Range");class bl{constructor(a){this.arr=a,this.pos=0}}let bm=a=>new bl(a),bn=(a,b)=>{let c=bv(a.arr.buffer,a.pos+a.arr.byteOffset,b);return a.pos+=b,c},bo=a=>bn(a,bq(a)),bp=a=>a.arr[a.pos++],bq=a=>{let b=0,c=1,d=a.arr.length;for(;a.pos<d;){let e=a.arr[a.pos++];if(b+=(127&e)*c,c*=128,e<128)return b;if(b>a4)throw bk}throw bj},br=a=>{let b=bq(a);if(0===b)return"";{let c=String.fromCodePoint(bp(a));if(--b<100)for(;b--;)c+=String.fromCodePoint(bp(a));else for(;b>0;){let d=b<1e4?b:1e4,e=a.arr.subarray(a.pos,a.pos+d);a.pos+=d,c+=String.fromCodePoint.apply(null,e),b-=d}return decodeURIComponent(escape(c))}},bs=a=>aI.decode(bo(a)),bt=aI?bs:br,bu=a=>new Uint8Array(a),bv=(a,b,c)=>new Uint8Array(a,b,c),bw=a=>new Uint8Array(a),bx=a=>{let b="";for(let c=0;c<a.byteLength;c++)b+=ay(a[c]);return btoa(b)},by=a=>au.from(a.buffer,a.byteOffset,a.byteLength).toString("base64"),bz=a=>{let b=atob(a),c=bu(b.length);for(let d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return c},bA=a=>{let b=au.from(a,"base64");return new Uint8Array(b.buffer,b.byteOffset,b.byteLength)},bB=aX?bx:by,bC=aX?bz:bA,bD=new Map,bE="undefined"==typeof BroadcastChannel?class{constructor(a){var b;this.room=a,this.onmessage=null,this._onChange=b=>b.key===a&&null!==this.onmessage&&this.onmessage({data:bC(b.newValue||"")}),b=this._onChange,aL||addEventListener("storage",b)}postMessage(a){aN.setItem(this.room,bB(bw(a)))}close(){aO(this._onChange)}}:BroadcastChannel,bF=a=>aw(bD,a,()=>{let b=ax(),c=new bE(a);return c.onmessage=a=>b.forEach(b=>b(a.data,"broadcastchannel")),{bc:c,subs:b}}),bG=(a,b)=>(bF(a).subs.add(b),b),bH=(a,b)=>{let c=bF(a),d=c.subs.delete(b);return d&&0===c.subs.size&&(c.bc.close(),bD.delete(a)),d},bI=(a,b,c=null)=>{let d=bF(a);d.bc.postMessage(b),d.subs.forEach(a=>a(b,c))},bJ=Date.now;class bK{constructor(){this._observers=av()}on(a,b){aw(this._observers,a,ax).add(b)}once(a,b){let c=(...d)=>{this.off(a,c),b(...d)};this.on(a,c)}off(a,b){let c=this._observers.get(a);void 0!==c&&(c.delete(b),0===c.size&&this._observers.delete(a))}emit(a,b){return aP((this._observers.get(a)||av()).values()).forEach(a=>a(...b))}destroy(){this._observers=av()}}let bL=(a,b,c)=>{let d=[];for(let e=0;e<b.length;e++){let f=b[e];if(a.states.has(f)){if(a.states.delete(f),f===a.clientID){let g=a.meta.get(f);a.meta.set(f,{clock:g.clock+1,lastUpdated:bJ()})}d.push(f)}}d.length>0&&(a.emit("change",[{added:[],updated:[],removed:d},c]),a.emit("update",[{added:[],updated:[],removed:d},c]))},bM=(a,b,c=a.states)=>{let d=b.length,e=a6();ba(e,d);for(let f=0;f<d;f++){let g=b[f],h=c.get(g)||null,i=a.meta.get(g).clock;ba(e,g),ba(e,i),bf(e,JSON.stringify(h))}return a8(e)},bN=(a,b,c)=>{let d=bm(b),e=bJ(),f=[],g=[],h=[],i=[],j=bq(d);for(let k=0;k<j;k++){let l=bq(d),m=bq(d),n=JSON.parse(bt(d)),o=a.meta.get(l),p=a.states.get(l),q=void 0===o?0:o.clock;(q<m||q===m&&null===n&&a.states.has(l))&&(null===n?l===a.clientID&&null!=a.getLocalState()?m++:a.states.delete(l):a.states.set(l,n),a.meta.set(l,{clock:m,lastUpdated:e}),void 0===o&&null!==n?f.push(l):void 0!==o&&null===n?i.push(l):null!==n&&(aV(n,p)||h.push(l),g.push(l)))}(f.length>0||h.length>0||i.length>0)&&a.emit("change",[{added:f,updated:h,removed:i},c]),(f.length>0||g.length>0||i.length>0)&&a.emit("update",[{added:f,updated:g,removed:i},c])},bO=()=>{let a=!0;return(b,c)=>{if(a){a=!1;try{b()}finally{a=!0}}else void 0!==c&&c()}};class bP{constructor(){this.callbacks={}}on(a,b){return this.callbacks[a]||(this.callbacks[a]=[]),this.callbacks[a].push(b),this}emit(a,...b){let c=this.callbacks[a];return c&&c.forEach(a=>a.apply(this,b)),this}off(a,b){let c=this.callbacks[a];return c&&(b?this.callbacks[a]=c.filter(a=>a!==b):delete this.callbacks[a]),this}removeAllListeners(){this.callbacks={}}}class bQ{constructor(a){this.data=a,this.encoder=a6(),this.decoder=bm(new Uint8Array(this.data))}readVarUint(){return bq(this.decoder)}readVarString(){return bt(this.decoder)}readVarUint8Array(){return bo(this.decoder)}writeVarUint(a){return ba(this.encoder,a)}writeVarString(a){return bf(this.encoder,a)}writeVarUint8Array(a){return bh(this.encoder,a)}length(){return a7(this.encoder)}}let bR=(a,b)=>{ba(a,0);let c=r.gJ(b);bh(a,c)},bS=(a,b,c)=>{ba(a,1),bh(a,r.D$(b,c))},bT=(a,b,c)=>bS(b,c,bo(a)),bU=(a,b,c)=>{try{r.NG(b,bo(a),c)}catch(d){console.error("Caught error while handling a Yjs update",d)}},bV=(a,b)=>{ba(a,2),bh(a,b)},bW=bU,bX=(a,b,c,d)=>{let e=bq(a);switch(e){case 0:bT(a,b,c);break;case 1:bU(a,c,d);break;case 2:bW(a,c,d);break;default:throw Error("Unknown message type")}return e};(l=p||(p={}))[l.Sync=0]="Sync",l[l.Awareness=1]="Awareness",l[l.Auth=2]="Auth",l[l.QueryAwareness=3]="QueryAwareness",l[l.Stateless=5]="Stateless",l[l.CLOSE=7]="CLOSE",(m=q||(q={})).Connecting="connecting",m.Connected="connected",m.Disconnected="disconnected";class bY{constructor(){this.encoder=a6()}get(a){return a.encoder}toUint8Array(){return a8(this.encoder)}}class bZ{constructor(a){this.broadcasted=!1,this.message=a}setBroadcasted(a){return this.broadcasted=a,this}apply(a,b=!0){let{message:c}=this,d=c.readVarUint(),e=c.length();switch(d){case p.Sync:this.applySyncMessage(a,b);break;case p.Awareness:this.applyAwarenessMessage(a);break;case p.Auth:this.applyAuthMessage(a);break;case p.QueryAwareness:this.applyQueryAwarenessMessage(a);break;case p.Stateless:a.receiveStateless(bt(c.decoder));break;default:throw Error(`Can’t apply message of unknown type: ${d}`)}c.length()>e+1&&(this.broadcasted?a.broadcast(bY,{encoder:c.encoder}):a.send(bY,{encoder:c.encoder}))}applySyncMessage(a,b){let{message:c}=this;c.writeVarUint(p.Sync);let d=bX(c.decoder,c.encoder,a.document,a);b&&1===d&&(a.synced=!0),(2===d||1===d)&&a.unsyncedChanges>0&&a.updateUnsyncedChanges(-1)}applyAwarenessMessage(a){let{message:b}=this;bN(a.awareness,b.readVarUint8Array(),a)}applyAuthMessage(a){let{message:b}=this;al(b.decoder,a.permissionDeniedHandler.bind(a),a.authenticatedHandler.bind(a))}applyQueryAwarenessMessage(a){let{message:b}=this;b.writeVarUint(p.Awareness),b.writeVarUint8Array(bM(a.awareness,Array.from(a.awareness.getStates().keys())))}}class b${constructor(a,b={}){this.message=new a,this.encoder=this.message.get(b)}create(){return a8(this.encoder)}send(a){null==a||a.send(this.create())}broadcast(a){bI(a,this.create())}}class b_ extends bY{constructor(){super(...arguments),this.type=p.Sync,this.description="First sync step"}get(a){if(void 0===a.document)throw Error("The sync step one message requires document as an argument");return bf(this.encoder,a.documentName),ba(this.encoder,this.type),bR(this.encoder,a.document),this.encoder}}class b0 extends bY{constructor(){super(...arguments),this.type=p.Sync,this.description="Second sync step"}get(a){if(void 0===a.document)throw Error("The sync step two message requires document as an argument");return bf(this.encoder,a.documentName),ba(this.encoder,this.type),bS(this.encoder,a.document),this.encoder}}class b1 extends bY{constructor(){super(...arguments),this.type=p.QueryAwareness,this.description="Queries awareness states"}get(a){return console.log("queryAwareness: writing string docName",a.documentName),console.log(this.encoder.cpos),bf(this.encoder,a.documentName),ba(this.encoder,this.type),this.encoder}}class b2 extends bY{constructor(){super(...arguments),this.type=p.Auth,this.description="Authentication"}get(a){if(void 0===a.token)throw Error("The authentication message requires `token` as an argument.");return bf(this.encoder,a.documentName),ba(this.encoder,this.type),ak(this.encoder,a.token),this.encoder}}class b3 extends bY{constructor(){super(...arguments),this.type=p.Awareness,this.description="Awareness states update"}get(a){if(void 0===a.awareness)throw Error("The awareness message requires awareness as an argument");if(void 0===a.clients)throw Error("The awareness message requires clients as an argument");bf(this.encoder,a.documentName),ba(this.encoder,this.type);let b;return b=void 0===a.states?bM(a.awareness,a.clients):bM(a.awareness,a.clients,a.states),bh(this.encoder,b),this.encoder}}class b4 extends bY{constructor(){super(...arguments),this.type=p.Sync,this.description="A document update"}get(a){return bf(this.encoder,a.documentName),ba(this.encoder,this.type),bV(this.encoder,a.update),this.encoder}}let b5=a=>aR(a,(a,b)=>`${encodeURIComponent(b)}=${encodeURIComponent(a)}`).join("&");class b6 extends bP{constructor(a){if(super(),this.configuration={url:"",document:void 0,awareness:void 0,WebSocketPolyfill:void 0,parameters:{},connect:!0,broadcast:!0,forceSyncInterval:!1,messageReconnectTimeout:3e4,delay:1e3,initialDelay:0,factor:2,maxAttempts:0,minDelay:1e3,maxDelay:3e4,jitter:!0,timeout:0,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,quiet:!1},this.subscribedToBroadcastChannel=!1,this.webSocket=null,this.shouldConnect=!0,this.status=q.Disconnected,this.lastMessageReceived=0,this.mux=bO(),this.intervals={forceSync:null,connectionChecker:null},this.connectionAttempt=null,this.receivedOnOpenPayload=void 0,this.receivedOnStatusPayload=void 0,this.boundConnect=this.connect.bind(this),this.setConfiguration(a),this.configuration.WebSocketPolyfill=a.WebSocketPolyfill?a.WebSocketPolyfill:WebSocket,this.on("open",this.configuration.onOpen),this.on("open",this.onOpen.bind(this)),this.on("connect",this.configuration.onConnect),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("status",this.configuration.onStatus),this.on("status",this.onStatus.bind(this)),this.on("disconnect",this.configuration.onDisconnect),this.on("close",this.configuration.onClose),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("close",this.onClose.bind(this)),this.on("message",this.onMessage.bind(this)),this.registerEventListeners(),this.intervals.connectionChecker=setInterval(this.checkConnection.bind(this),this.configuration.messageReconnectTimeout/10),void 0!==a.connect&&(this.shouldConnect=a.connect),!this.shouldConnect)return;this.connect()}async onOpen(a){this.receivedOnOpenPayload=a}async onStatus(a){this.receivedOnStatusPayload=a}attach(a){this.receivedOnOpenPayload&&a.onOpen(this.receivedOnOpenPayload),this.receivedOnStatusPayload&&a.onStatus(this.receivedOnStatusPayload)}detach(a){}setConfiguration(a={}){this.configuration={...this.configuration,...a}}async connect(){if(this.status===q.Connected)return;this.cancelWebsocketRetry&&(this.cancelWebsocketRetry(),this.cancelWebsocketRetry=void 0),this.shouldConnect=!0;let{retryPromise:a,cancelFunc:b}=(()=>{let a=!1,b=as(this.createWebSocketConnection.bind(this),{delay:this.configuration.delay,initialDelay:this.configuration.initialDelay,factor:this.configuration.factor,maxAttempts:this.configuration.maxAttempts,minDelay:this.configuration.minDelay,maxDelay:this.configuration.maxDelay,jitter:this.configuration.jitter,timeout:this.configuration.timeout,beforeAttempt:b=>{(!this.shouldConnect||a)&&b.abort()}}).catch(a=>{if(a&&"ATTEMPT_ABORTED"!==a.code)throw a});return{retryPromise:b,cancelFunc:()=>{a=!0}}})();return this.cancelWebsocketRetry=b,a}createWebSocketConnection(){return new Promise((a,b)=>{this.webSocket&&(this.webSocket.close(),this.webSocket=null);let c=new this.configuration.WebSocketPolyfill(this.url);c.binaryType="arraybuffer",c.onmessage=a=>this.emit("message",a),c.onclose=a=>this.emit("close",{event:a}),c.onopen=a=>this.emit("open",a),c.onerror=a=>{b(a)},this.webSocket=c,this.status=q.Connecting,this.emit("status",{status:q.Connecting}),this.connectionAttempt={resolve:a,reject:b}})}onMessage(a){this.resolveConnectionAttempt(),this.lastMessageReceived=bJ()}resolveConnectionAttempt(){this.connectionAttempt&&(this.connectionAttempt.resolve(),this.connectionAttempt=null,this.status=q.Connected,this.emit("status",{status:q.Connected}),this.emit("connect"))}stopConnectionAttempt(){this.connectionAttempt=null}rejectConnectionAttempt(){var a;null===(a=this.connectionAttempt)|| void 0===a||a.reject(),this.connectionAttempt=null}checkConnection(){var a;!(this.status!==q.Connected||!this.lastMessageReceived||this.configuration.messageReconnectTimeout>=bJ()-this.lastMessageReceived)&&(null===(a=this.webSocket)|| void 0===a||a.close())}registerEventListeners(){"undefined"!=typeof window&&window.addEventListener("online",this.boundConnect)}get serverUrl(){for(;"/"===this.configuration.url[this.configuration.url.length-1];)return this.configuration.url.slice(0,this.configuration.url.length-1);return this.configuration.url}get url(){let a=b5(this.configuration.parameters);return`${this.serverUrl}${0===a.length?"":`?${a}`}`}disconnect(){if(this.shouldConnect=!1,null!==this.webSocket)try{this.webSocket.close()}catch{}}send(a){var b;(null===(b=this.webSocket)|| void 0===b?void 0:b.readyState)===o.Open&&this.webSocket.send(a)}onClose({event:a}){if(this.webSocket=null,this.status===q.Connected&&(this.status=q.Disconnected,this.emit("status",{status:q.Disconnected}),this.emit("disconnect",{event:a})),a.code===an.code&&(a.reason===an.reason?console.warn("[HocuspocusProvider] An authentication token is required, but you didn’t send one. Try adding a `token` to your HocuspocusProvider configuration. Won’t try again."):console.warn(`[HocuspocusProvider] Connection closed with status Unauthorized: ${a.reason}`),this.shouldConnect=!1),a.code===ao.code&&!this.configuration.quiet){console.warn("[HocuspocusProvider] The provided authentication token isn’t allowed to connect to this server. Will try again.");return}a.code===am.code&&(console.warn(`[HocuspocusProvider] Connection closed with status MessageTooBig: ${a.reason}`),this.shouldConnect=!1),this.connectionAttempt?this.rejectConnectionAttempt():this.shouldConnect&&this.connect(),!this.shouldConnect&&this.status!==q.Disconnected&&(this.status=q.Disconnected,this.emit("status",{status:q.Disconnected}),this.emit("disconnect",{event:a}))}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),clearInterval(this.intervals.connectionChecker),this.stopConnectionAttempt(),this.disconnect(),this.removeAllListeners(),"undefined"!=typeof window&&window.removeEventListener("online",this.boundConnect)}}class b7 extends bY{constructor(){super(...arguments),this.type=p.Stateless,this.description="A stateless message"}get(a){var b;return bf(this.encoder,a.documentName),ba(this.encoder,this.type),bf(this.encoder,null!==(b=a.payload)&& void 0!==b?b:""),this.encoder}}class b8 extends bY{constructor(){super(...arguments),this.type=p.CLOSE,this.description="Ask the server to close the connection"}get(a){return bf(this.encoder,a.documentName),ba(this.encoder,this.type),this.encoder}}class b9 extends bP{constructor(a){super(),this.configuration={name:"",document:void 0,awareness:void 0,token:null,parameters:{},broadcast:!0,forceSyncInterval:!1,onAuthenticated:()=>null,onAuthenticationFailed:()=>null,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onSynced:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,onStateless:()=>null,quiet:!1},this.subscribedToBroadcastChannel=!1,this.isSynced=!1,this.unsyncedChanges=0,this.status=q.Disconnected,this.isAuthenticated=!1,this.authorizedScope=void 0,this.mux=bO(),this.intervals={forceSync:null},this.isConnected=!0,this.boundBeforeUnload=this.beforeUnload.bind(this),this.boundBroadcastChannelSubscriber=this.broadcastChannelSubscriber.bind(this),this.setConfiguration(a),this.configuration.document=a.document?a.document:new r.QW,this.configuration.awareness=a.awareness?a.awareness:new class extends bK{constructor(a){super(),this.doc=a,this.clientID=a.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let a=bJ();null!==this.getLocalState()&&15e3<=a-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let b=[];this.meta.forEach((c,d)=>{d!==this.clientID&&3e4<=a-c.lastUpdated&&this.states.has(d)&&b.push(d)}),b.length>0&&bL(this,b,"timeout")},a1(3e3)),a.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(a){let b=this.clientID,c=this.meta.get(b),d=void 0===c?0:c.clock+1,e=this.states.get(b);null===a?this.states.delete(b):this.states.set(b,a),this.meta.set(b,{clock:d,lastUpdated:bJ()});let f=[],g=[],h=[],i=[];null===a?i.push(b):null==e?null!=a&&f.push(b):(g.push(b),aV(e,a)||h.push(b)),(f.length>0||h.length>0||i.length>0)&&this.emit("change",[{added:f,updated:h,removed:i},"local"]),this.emit("update",[{added:f,updated:g,removed:i},"local"])}setLocalStateField(a,b){let c=this.getLocalState();null!==c&&this.setLocalState({...c,[a]:b})}getStates(){return this.states}}(this.document),this.on("open",this.configuration.onOpen),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("synced",this.configuration.onSynced),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("stateless",this.configuration.onStateless),this.on("authenticated",this.configuration.onAuthenticated),this.on("authenticationFailed",this.configuration.onAuthenticationFailed),this.configuration.websocketProvider.on("connect",this.configuration.onConnect),this.configuration.websocketProvider.on("connect",a=>this.emit("connect",a)),this.configuration.websocketProvider.on("open",this.onOpen.bind(this)),this.configuration.websocketProvider.on("open",a=>this.emit("open",a)),this.configuration.websocketProvider.on("message",this.onMessage.bind(this)),this.configuration.websocketProvider.on("close",this.onClose.bind(this)),this.configuration.websocketProvider.on("close",this.configuration.onClose),this.configuration.websocketProvider.on("close",a=>this.emit("close",a)),this.configuration.websocketProvider.on("status",this.onStatus.bind(this)),this.configuration.websocketProvider.on("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.on("disconnect",a=>this.emit("disconnect",a)),this.configuration.websocketProvider.on("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.on("destroy",a=>this.emit("destroy",a)),this.awareness.on("update",()=>{this.emit("awarenessUpdate",{states:ap(this.awareness.getStates())})}),this.awareness.on("change",()=>{this.emit("awarenessChange",{states:ap(this.awareness.getStates())})}),this.document.on("update",this.documentUpdateHandler.bind(this)),this.awareness.on("update",this.awarenessUpdateHandler.bind(this)),this.registerEventListeners(),this.configuration.forceSyncInterval&&(this.intervals.forceSync=setInterval(this.forceSync.bind(this),this.configuration.forceSyncInterval)),this.configuration.websocketProvider.attach(this)}onStatus({status:a}){this.status=a,this.configuration.onStatus({status:a}),this.emit("status",{status:a})}setConfiguration(a={}){if(!a.websocketProvider&&a.url){let b=a;this.configuration.websocketProvider=new b6({url:b.url,parameters:b.parameters})}this.configuration={...this.configuration,...a}}get document(){return this.configuration.document}get awareness(){return this.configuration.awareness}get hasUnsyncedChanges(){return this.unsyncedChanges>0}updateUnsyncedChanges(a=0){this.unsyncedChanges+=a,this.emit("unsyncedChanges",this.unsyncedChanges)}forceSync(){this.send(b_,{document:this.document,documentName:this.configuration.name})}beforeUnload(){bL(this.awareness,[this.document.clientID],"window unload")}registerEventListeners(){"undefined"!=typeof window&&window.addEventListener("beforeunload",this.boundBeforeUnload)}sendStateless(a){this.send(b7,{documentName:this.configuration.name,payload:a})}documentUpdateHandler(a,b){b!==this&&(this.updateUnsyncedChanges(1),this.send(b4,{update:a,documentName:this.configuration.name},!0))}awarenessUpdateHandler({added:a,updated:b,removed:c},d){let e=a.concat(b).concat(c);this.send(b3,{awareness:this.awareness,clients:e,documentName:this.configuration.name},!0)}get synced(){return this.isSynced}set synced(a){this.isSynced!==a&&(a&&this.unsyncedChanges>0&&this.updateUnsyncedChanges(-1*this.unsyncedChanges),this.isSynced=a,this.emit("synced",{state:a}),this.emit("sync",{state:a}))}receiveStateless(a){this.emit("stateless",{payload:a})}get isAuthenticationRequired(){return!!this.configuration.token&&!this.isAuthenticated}async connect(){return this.configuration.websocketProvider.connect()}disconnect(){this.disconnectBroadcastChannel(),this.configuration.websocketProvider.detach(this)}async onOpen(a){this.isAuthenticated=!1,this.emit("open",{event:a}),this.isAuthenticationRequired&&this.send(b2,{token:await this.getToken(),documentName:this.configuration.name}),this.startSync()}async getToken(){if("function"==typeof this.configuration.token){let a=await this.configuration.token();return a}return this.configuration.token}startSync(){this.send(b_,{document:this.document,documentName:this.configuration.name}),null!==this.awareness.getLocalState()&&this.send(b3,{awareness:this.awareness,clients:[this.document.clientID],documentName:this.configuration.name})}send(a,b,c=!1){if(!this.isConnected)return;c&&this.mux(()=>{this.broadcast(a,b)});let d=new b$(a,b);this.emit("outgoingMessage",{message:d.message}),d.send(this.configuration.websocketProvider)}onMessage(a){let b=new bQ(a.data),c=b.readVarString();c===this.configuration.name&&(b.writeVarString(c),this.emit("message",{event:a,message:new bQ(a.data)}),new bZ(b).apply(this))}onClose(a){this.isAuthenticated=!1,this.synced=!1,bL(this.awareness,Array.from(this.awareness.getStates().keys()).filter(a=>a!==this.document.clientID),this)}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),bL(this.awareness,[this.document.clientID],"provider destroy"),this.disconnect(),this.awareness.off("update",this.awarenessUpdateHandler),this.document.off("update",this.documentUpdateHandler),this.removeAllListeners(),this.send(b8,{documentName:this.configuration.name}),this.isConnected=!1,"undefined"!=typeof window&&window.removeEventListener("beforeunload",this.boundBeforeUnload)}permissionDeniedHandler(a){this.emit("authenticationFailed",{reason:a}),this.isAuthenticated=!1,this.disconnect(),this.status=q.Disconnected}authenticatedHandler(a){this.isAuthenticated=!0,this.authorizedScope=a,this.emit("authenticated"),this.startSync()}get broadcastChannel(){return`${this.configuration.name}`}broadcastChannelSubscriber(a){this.mux(()=>{let b=new bQ(a),c=b.readVarString();b.writeVarString(c),new bZ(b).setBroadcasted(!0).apply(this,!1)})}subscribeToBroadcastChannel(){this.subscribedToBroadcastChannel||(bG(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!0),this.mux(()=>{this.broadcast(b_,{document:this.document}),this.broadcast(b0,{document:this.document}),this.broadcast(b1,{document:this.document}),this.broadcast(b3,{awareness:this.awareness,clients:[this.document.clientID],document:this.document})})}disconnectBroadcastChannel(){this.send(b3,{awareness:this.awareness,clients:[this.document.clientID],states:new Map,documentName:this.configuration.name},!0),this.subscribedToBroadcastChannel&&(bH(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!1)}broadcast(a,b){this.configuration.broadcast&&this.subscribedToBroadcastChannel&&new b$(a,b).broadcast(this.broadcastChannel)}setAwarenessField(a,b){this.awareness.setLocalStateField(a,b)}}},36908:function(a,b,c){c.d(b,{Ag:function(){return e}});let d=Date.now,e=(a,b,c)=>{let e=[];for(let f=0;f<b.length;f++){let g=b[f];if(a.states.has(g)){if(a.states.delete(g),g===a.clientID){let h=a.meta.get(g);a.meta.set(g,{clock:h.clock+1,lastUpdated:d()})}e.push(g)}}e.length>0&&(a.emit("change",[{added:[],updated:[],removed:e},c]),a.emit("update",[{added:[],updated:[],removed:e},c]))}}}])
//# sourceMappingURL=91222-4d52a6fba51501be.js.map